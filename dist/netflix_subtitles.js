(()=>{"use strict";const e=(e={},t={payload:Number})=>{if(e){const o=e;o.playbackRate=t.payload,o.dataset.CustomPlaybackRate=e.playbackRate}},t=(e={},t={payload:Number})=>{if(e){const o=document.querySelector("[data--custom-playback-rate]")||document.querySelector("video");o.playbackRate=t.payload,o.dataset.CustomPlaybackRate=e.playbackRate}},o=(e={payload:Number},t={})=>{if(void 0===e.payload||!t)return!0;const o=t.playbackRate,a=Number(e.payload);if(o!==a){const e=t;return e.playbackRate=a,e.dataset.CustomPlaybackRate=t.playbackRate,!1}return!0},a=()=>{const a=setInterval((()=>{document.querySelector("video")&&(((a={},l=!1)=>{let n=a.querySelector("video");if(!n)return!1;const s={request:{payload:n.playbackRate}};l?t(n,s.request):e(n,s.request),chrome.runtime.onMessage.addListener(((a,l,s)=>{if("changePlaybackSpeed"===a.message||"getPlayBackSpeedOnPageLoad"===a.message){if("www.netflix.com"===document.location.hostname&&"getPlayBackSpeedOnPageLoad"===a.message){console.count("location and message");const e=setTimeout((()=>{const t=setInterval((()=>{n=document.querySelector("video"),n&&o(a,n)&&clearInterval(t)}),500);clearTimeout(e)}),500)}else if("getPlayBackSpeedOnPageLoad"===a.message){const e=setTimeout((()=>{const t=setInterval((()=>{o(a,n)&&clearInterval(t)}),500);clearTimeout(e)}),500)}return"changePlaybackSpeed"===a.message&&"www.netflix.com"===document.location.hostname?t(n,a):"changePlaybackSpeed"===a.message&&e(n,a),s({message:"success",payload:n.playbackRate}),!0}return!0})),((e={})=>{chrome.runtime.sendMessage({message:"foundVideo",payload:e.playbackRate},(t=>{const{lastError:o=""}=chrome.runtime;if(o)console.log(o);else if("foundVideoSuccess"===t?.message&&null!==t.payload){const o=e;o.playbackRate=t.payload,o.dataset.CustomPlaybackRate=o.playbackRate}}))})(n)})(window.document.body,!0),console.log("adding listeners for netflix..."),clearInterval(a))}),1e3)},l={verticalPosition:null,fontSize:null,fontColor:null,fontWeight:null};let n=null;const s=(e=0,t=32,o="currentColor",a="currentColor",s=!1)=>{s&&null!==n?n.disconnect():(null!==n&&n.disconnect(),n=(n=>{const r=new MutationObserver((()=>{const n=document.querySelector(".player-timedtext");n&&(null===l.verticalPosition&&(l.verticalPosition=parseFloat(n.style.bottom)),n.style.bottom=`${e}px`,[...n.querySelectorAll(".player-timedtext-text-container")].forEach((e=>{if(e){const n=e;s||(n.style.left="0",n.style.right="0"),((e={})=>{const n=e.children;n.length&&[...n].forEach((e=>{const n=e;null===l.fontSize&&(l.fontSize=parseFloat(n.style.fontSize)),null===l.fontColor&&(l.fontColor=((e="")=>{if(!e.includes("rgb("))return e;const t=e.indexOf(",")>-1?",":" ",o=e.substr(4).split(")")[0].split(t);let a=(+o[0]).toString(16),l=(+o[1]).toString(16),n=(+o[2]).toString(16);return 1===a.length&&(a=`0${a}`),1===l.length&&(l=`0${l}`),1===n.length&&(n=`0${n}`),`#${a}${l}${n}`})(n.style.color)),null===l.fontWeight&&(l.fontWeight=n.style.fontWeight),n.style.fontSize=`${t}px`,n.style.fontWeight=a,n.style.color=o}))})(n)}})))}));return r.observe(document.body.querySelector(".VideoContainer"),{subtree:!0,attributes:!1,childList:!0}),r})())};chrome.runtime.onMessage.hasListeners()||(a(),chrome.runtime.onMessage.addListener(((e,t,o)=>{if("update_netflix_subtitles_styles"===e.message){const{verticalPosition:t=0,fontSize:a=32,fontColor:l="currentColor",fontWeight:n="normal"}=e.payload,r=setInterval((()=>{document?.querySelector(".player-timedtext")?.firstChild&&(s(t,a,l,n),clearInterval(r))}),1e3);return o({message:"netflix subtitles styles enabled",payload:null}),!0}if("reset_subtitles"===e.message){const{verticalPosition:e,fontSize:t,fontColor:a,fontWeight:n}=l;if(Object.keys(l).every((e=>null===l[e])))return null;s(e,t,a,n,!0),((e={payload:{verticalPosition:Number,fontColor:"",fontSize:Number,fontWeight:Number}})=>{chrome.storage.local.set({subtitlesOptions:e.payload})})({payload:{verticalPosition:e,fontSize:t,fontWeight:n,fontColor:a}}),o({message:"reset_subtitles",payload:{verticalPosition:e,fontSize:t,fontColor:a,fontWeight:n}}),Object.keys(l).forEach((e=>{l[e]=null}))}return!0})))})();